# Vig

**Vig** は VHDL のテストベンチを自動生成する Rust 製のツールです。

**V**HDL + R**ig** → **Vig**

## 特徴

- **高速な字句解析と構文解析**: Rust で実装された効率的なパーサー
- **自動テストベンチ生成**: エンティティの port 情報から完全なテストベンチを生成
- **クロック・リセット信号の自動生成**: `clk`, `reset` 信号を自動検出して適切に初期化
- **デバッグモード**: `-d` フラグで詳細な解析情報を表示
- **パイプライン対応**: 標準出力にテストベンチを出力するため、リダイレクトやパイプが可能

## インストール

### 前提条件

- Rust 1.70 以降

### ビルド

```bash
git clone <repository-url>
cd vig
cargo build --release
```

ビルドされた実行ファイルは `target/release/vig` に生成されます。

### インストール（オプション）

```bash
# システムにインストール
cargo install --path .

# または、PATHに追加
export PATH="$PATH:$(pwd)/target/release"
```

## 使い方

### 基本的な使い方

```bash
# テストベンチを生成
vig <VHDLファイル>

# または開発時
cargo run <VHDLファイル>

# ファイルに出力
vig <VHDLファイル> > output_tb.vhd

# 複数エンティティを含むファイルも対応
vig design.vhd > design_tb.vhd
```

### デバッグモード

```bash
# 構文解析と意味解析の結果を表示
vig -d <VHDLファイル>

# または開発時
cargo run -- -d <VHDLファイル>
```

デバッグモードでは以下の情報が標準エラー出力（stderr）に表示されます：
- トークン解析結果（字句解析）
- エンティティとポート情報（意味解析）
- 生成されるテストベンチの情報

通常モードでは標準出力（stdout）にテストベンチのみが出力されます。

## サポートする VHDL 機能

### キーワード
- エンティティ定義: `entity`, `port`, `generic`
- アーキテクチャ: `architecture`, `signal`, `process`, `begin`, `end`
- 制御構造: `if`, `then`, `else`, `elsif`, `case`, `when`
- 方向指定: `in`, `out`, `inout`, `buffer`, `to`, `downto`

### データ型
- `std_logic`
- `std_logic_vector`
- `integer`
- `boolean`

### 演算子
- 論理演算子: `and`, `or`, `not`, `xor`, `nand`, `nor`
- 比較演算子: `=`, `/=`, `<`, `<=`, `>`, `>=`
- 算術演算子: `+`, `-`, `*`, `/`, `**`
- 代入演算子: `:=`, `<=`
- 連結演算子: `&`
- 関連付け: `=>`

## 注意点

### 現在の制限事項

1. **ジェネリック (generic) パラメータ**
   - 解析はサポートしていますが、テストベンチ生成時にデフォルト値を使用します
   - カスタムジェネリック値が必要な場合は手動で編集してください

2. **複雑な型定義**
   - カスタム型や record 型は完全にはサポートされていません
   - 標準的な型（`std_logic`, `std_logic_vector`, `integer`）を使用することを推奨します

3. **クロック周期**
   - デフォルトのクロック周期は 10ns です
   - 変更する場合は `TbConfig` を調整してください

4. **入力信号のテストパターン**
   - 生成されたスティミュラスは基本的なプレースホルダーです
   - 実際のテストケースに合わせて手動で編集する必要があります

5. **コメント**
   - コメントはトークンとして認識されますが、出力には含まれません

### 推奨事項

- **命名規則**: クロック信号は `clk` または `clock`、リセット信号は `reset` または `rst` という名前を使用すると自動認識されます
- **ファイルエンコーディング**: UTF-8 を使用してください
- **VHDL バージョン**: VHDL-93/2008 の基本的な構文をサポートしています
